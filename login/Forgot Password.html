<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Forgot Password</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
	<link href="forgot-password-style.css" rel="stylesheet">
</head>
<body class="split-screen-body">
	<div class="split-container">

		<!-- Left Side - Slideshow -->
		<div class="split-left">
			<div class="slideshow" id="auth-slideshow">
				<div class="slides"></div>
				<div class="slide-overlay">
					<div class="quote-text" id="slide-quote"></div>
					<div class="quote-author" id="slide-author"></div>
					<div class="slide-indicators" id="slide-indicators"></div>
				</div>
			</div>
		</div>

		<!-- Right Side - Forgot Password Form -->
		<div class="split-right">
			<div class="form-card">
				<form id="forgotForm" class="auth-form" novalidate>
					<h2 class="form-title">Forgot password?</h2>
					<p style="color:#666;margin:8px 0 18px 0;text-align:center;">Enter the email associated with your account and we'll send a link to reset your password.</p>

					<div class="form-group">
						<input type="email" id="email" name="email" placeholder="Email" required>
					</div>

					<div class="login-button">
						<button id="sendBtn" class="btn" type="submit">Send reset link</button>
					</div>

					<div id="message" style="display:none;margin-top:12px;text-align:center;font-size:14px;padding:8px;border-radius:8px;"> </div>

					<div class="form-footer">
						<span class="footer-text"><a href="Log-in.html" class="link-text-bold">Return to sign in</a></span>
					</div>
				</form>
			</div>
		</div>
	</div>

	<script src="login-slideshow.js"></script>
	<script src="runtime-config.js"></script>
	<script type="module" src="supabaseClient.js"></script>
	<script>
		(function(){
			var form = document.getElementById('forgotForm');
			var email = document.getElementById('email');
			var btn = document.getElementById('sendBtn');
			var msg = document.getElementById('message');

			function showMessage(text, type){
				msg.style.display = 'block';
				msg.textContent = text;
				if(type === 'ok'){
					msg.style.background = 'rgba(74,157,74,0.12)';
					msg.style.color = '#1f7a1f';
					msg.style.border = '1px solid rgba(74,157,74,0.18)';
				} else {
					msg.style.background = 'rgba(255,80,80,0.06)';
					msg.style.color = '#8a1f1f';
					msg.style.border = '1px solid rgba(255,80,80,0.14)';
				}
			}

			form.addEventListener('submit', async function(e){
				e.preventDefault();
				if(!email.value || !email.checkValidity()){
					showMessage('Please enter a valid email address.', 'err');
					return;
				}

				if (!window.supabase || !window.supabase.auth || !window.supabase.auth.resetPasswordForEmail) {
					showMessage('Password reset is temporarily unavailable. Please try again later.', 'err');
					return;
				}

				btn.disabled = true;
				btn.textContent = 'Sending...';

				try {
					var redirectUrl = window.location.origin + '/login/resetpass.html';
					var trimmedEmail = email.value.trim();
					var result = await window.supabase.auth.resetPasswordForEmail(trimmedEmail, { redirectTo: redirectUrl });
					if (result.error) {
						console.error('Supabase resetPasswordForEmail error:', result.error.message || result.error);
						showMessage('Unable to send reset email. Please try again later.', 'err');
					} else {
						// For privacy, use generic success text regardless of whether email exists.
						showMessage('If an account with that email exists, a password reset link has been sent.', 'ok');
					}
				} catch (err) {
					console.error('Unexpected error during password reset:', err);
					showMessage('Unexpected error. Please try again later.', 'err');
				} finally {
					btn.disabled = false;
					btn.textContent = 'Send reset link';
				}
			});
		})();
	</script>
</body>
</html>
