<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registration Form</title>
    <link href="login-style.css" rel="stylesheet">
</head>
<body class="split-screen-body">
    <div class="split-container">
        <span class="form-badge"></span>
        <!-- Left Side - Registration Form -->
        <div class="split-left-form">
            <div class="form-card">
                <form id="registrationForm" class="auth-form" novalidate>
                    <h2 class="form-title">Create an account</h2>
                    <div class="form-group">
                        <input 
                            type="text" 
                            id="username" 
                            name="username" 
                            placeholder="Username">
                    </div>

                    <div class="form-group">
                        <input 
                            type="email" 
                            id="email" 
                            name="email" 
                            placeholder="Email" 
                            pattern="[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}"
                            title="Please enter a valid email address"
                            required>
                    </div>

                    <div class="form-group">
                        <input 
                            type="password" 
                            id="password" 
                            name="password" 
                            placeholder="Password" >
                    </div>

                    <div class="form-group">
                        <input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm password" required>
                    </div>

                    <div class="form-group">
                        <div class="select-wrapper">
                            <select id="role" name="role" required>
                                <option value="">Select Role</option>
                                <option value="commuter">Commuter</option>
                                <option value="driver">Driver</option>
                            </select>
                        </div>
                    </div>

                    <!-- Commuter-Specific Fields (dynamically required) -->
                    <div id="commuterFields" style="display:none;">
                                <div class="form-group">
                                    <div class="select-wrapper">
                                         <select id="commuterDocType" name="commuterDocType" required aria-label="ID Document Type">
                                                <option value="">Select ID Document Type</option>
                                                <option value="student_id">Student ID</option>
                                                <option value="Voters">Voters ID</option>
                                                <option value="national_id">National ID</option>
                                         </select>
                                    </div>
                                </div>
                        <div class="form-group">
                            <input 
                                type="text" 
                                id="identityDocument" 
                                name="identityDocument" 
                                placeholder="ID Number"
                                 >
                        </div>

                        <div class="form-group">
                            <label for="commuterIdUpload" class="upload-label">Upload ID Document</label>
                            <input type="file" id="commuterIdUpload" name="commuterIdUpload" accept="image/*,application/pdf">
                        </div>
                    </div>

                    <!-- Driver-Specific Fields (dynamically required) -->
                    <div id="driverFields" style="display:none;">
                        <div class="form-group">
                            <input 
                                type="text" 
                                id="plateNumber" 
                                name="plateNumber" 
                                placeholder="Plate Number (ABC1234)"
                                    >
                        </div>
                        <div class="form-group">
                            <input 
                                type="text" 
                                id="licenseNumber" 
                                name="licenseNumber" 
                                placeholder="License Number (A12-34-123456)">
                        </div>
                        <div class="form-group">
                            <label for="driverLicenseUpload" class="upload-label">Upload Driver's License</label>
                            <input type="file" id="driverLicenseUpload" name="driverLicenseUpload" accept="image/*,application/pdf">
                        </div>
                    </div>
                    
                    <!-- Terms and Agreement -->
                    <div class="terms-group">
                        <label class="terms-label">
                            <input type="checkbox" id="termsCheckbox" name="terms" required>
                            <span>I agree to the <a href="#" class="terms-link">Terms and Conditions</a> and <a href="#" class="terms-link">Privacy Policy</a>. I understand that my data will be collected and used in accordance with these policies.</span>
                        </label>
                    </div>
                    
                    <button type="submit" class="auth-btn">Sign up</button>

                    <!-- Inline message area (used for validation/success) -->
                    <div id="formMessage" class="form-message" role="alert" aria-live="assertive" style="display:none;margin-top:12px;padding:10px;border-radius:6px;font-size:0.95rem;"></div>

                    <div class="form-footer">
                        <span class="footer-text">Already have an account? <a href="Log-in.html" class="link-text-bold">Sign in here</a></span>
                    </div>
                </form>
            </div>
        </div>

        <!-- Right Side - Slideshow -->
        <div class="split-right-green">
            <div class="slideshow" id="auth-slideshow">
                <div class="slides"></div>
                <div class="slide-overlay">
                    <div class="quote-text" id="slide-quote"></div>
                    <div class="quote-author" id="slide-author"></div>
                    <div class="slide-indicators" id="slide-indicators"></div>
                </div>
            </div>
        </div>
    </div> <!-- .split-container -->
    <!-- Terms & Conditions Modal -->
    <div id="termsModal" class="modal-overlay" role="dialog" aria-modal="true" aria-labelledby="termsModalTitle">
        <div class="modal-content" role="document">
            <div class="modal-header">
                <div class="modal-title" id="termsModalTitle">Terms and Conditions</div>
            </div>
            <div class="modal-body" id="termsModalBody">
                <p>Welcome to the Jeepney Tracking Web Application. By accessing or using this application, you agree to comply with and be bound by the following terms and conditions. If you do not agree with any part of these terms, you must immediately stop using the application.</p>

                <p>All users must register to use the application, providing accurate and truthful information, including their username, email, password, and role as either a commuter or driver. Commuters are required to submit a valid identity document, while drivers must provide their vehicle plate number and a valid driver’s license. Users are solely responsible for maintaining the confidentiality of their login credentials and for all activities that occur under their accounts. Sharing login credentials or allowing unauthorized access to your account is strictly prohibited.</p>

                <p>The service is provided to commuters for the purpose of tracking the estimated arrival times of jeepneys near their location. Drivers provide real-time location updates to ensure the system functions accurately. Users must not engage in any activity that could disrupt, interfere with, or compromise the functionality of the application, including but not limited to attempting unauthorized access, uploading false or misleading documents, or misusing the system for any purpose other than its intended use.</p>

                <p>All content, data, and software associated with this application, including user-submitted content, remains the property of the developers or the respective users and is protected by applicable intellectual property laws. Users may not reproduce, distribute, modify, or publicly display any part of the application or its content without prior written consent from the developers.</p>

                <p>The application is provided on an "as-is" basis. While the developers strive to ensure that the service is accurate and reliable, the application may experience occasional interruptions, delays, or inaccuracies, including errors in jeepney location tracking or estimated arrival times. The developers do not guarantee the completeness, reliability, or timeliness of any information provided and are not liable for any damages or losses arising from the use or inability to use the application.</p>

                <p>Users found violating these terms, submitting falsified information, or engaging in prohibited activities may have their accounts suspended or permanently terminated without prior notice. The developers reserve the right to modify, suspend, or discontinue the application at any time without liability. Changes to these terms and conditions may occur periodically, and continued use of the application constitutes acceptance of any updated terms.</p>

                <p>By using this application, you acknowledge that you have read, understood, and agreed to these terms and conditions, and you consent to the collection, use, and storage of your personal information in accordance with the application’s privacy policy.</p>
            </div>
            <div class="modal-actions">
                <button class="btn-close" type="button">Close</button>
                <button id="acceptTermsBtn" class="btn-accept" type="button">Accept & Continue</button>
            </div>
        </div>
    </div>

        <!-- Fallback script to ensure role fields appear even if module import fails -->
        <script>
            (function(){
                function roleInit(){
                    var r=document.getElementById('role');
                    var c=document.getElementById('commuterFields');
                    var d=document.getElementById('driverFields');
                    if(!r||!c||!d) return;
                    c.style.display='none';
                    d.style.display='none';
                    if(r.value==='commuter') c.style.display='block';
                    else if(r.value==='driver') d.style.display='block';
                }
                document.addEventListener('DOMContentLoaded', function(){
                    var r=document.getElementById('role');
                    if(r){
                        r.addEventListener('change', roleInit);
                        roleInit();
                    }
                });
            })();
        </script>
        <script>
            (function(){
                var checkbox = document.getElementById('termsCheckbox');
                var modal = document.getElementById('termsModal');
                var acceptBtn = document.getElementById('acceptTermsBtn');
                var modalBody = modal ? modal.querySelector('.modal-body') : null;
                var closeBtns = modal ? modal.querySelectorAll('.close-modal, .btn-close') : [];

                function openModal(e){
                    if(e && e.preventDefault) e.preventDefault();
                    if(!modal) return;
                    // show overlay immediately (use inline style to avoid layout thrash)
                    modal.style.display = 'flex';
                    document.body.style.overflow = 'hidden';

                    // hide accept until user scrolls to bottom
                    if(acceptBtn){
                        acceptBtn.style.display = 'none';
                        acceptBtn.setAttribute('aria-hidden','true');
                    }

                    // focus the visible footer Close button (or Accept) for keyboard users
                    var focusEl = modal.querySelector('.btn-close') || modal.querySelector('#acceptTermsBtn');
                    if(focusEl) focusEl.focus();

                    // attach scroll listener on next frame to avoid blocking the opening
                    if(modalBody){
                        requestAnimationFrame(function(){
                            // run once to set initial state
                            checkScroll();
                            modalBody.addEventListener('scroll', checkScroll, {passive:true});
                        });
                    }
                }

                function closeModal(){
                    if(!modal) return;
                    modal.style.display = 'none';
                    document.body.style.overflow = '';
                    if(modalBody){ modalBody.removeEventListener('scroll', checkScroll); }
                }

                // show Accept when scrolled to bottom, or immediately if content not scrollable
                function checkScroll(){
                    if(!modalBody || !acceptBtn) return;
                    var atBottom = false;
                    if(modalBody.scrollHeight <= modalBody.clientHeight + 1) atBottom = true;
                    else if(modalBody.scrollTop + modalBody.clientHeight >= modalBody.scrollHeight - 6) atBottom = true;

                    if(atBottom){
                        acceptBtn.style.display = 'inline-block';
                        acceptBtn.removeAttribute('aria-hidden');
                    } else {
                        acceptBtn.style.display = 'none';
                        acceptBtn.setAttribute('aria-hidden','true');
                    }
                }

                // open when terms link pressed (pointerdown to reduce perceived delay)
                document.addEventListener('pointerdown', function(ev){
                    var t = ev.target;
                    if(t && t.classList && t.classList.contains('terms-link')){
                        // prevent default action for anchors
                        ev.preventDefault();
                        openModal();
                    }
                });

                // when user tries to check the box, open modal on pointerdown to avoid delay
                if(checkbox){
                    checkbox.addEventListener('pointerdown', function(e){
                        if(!checkbox.checked){
                            e.preventDefault();
                            openModal();
                        }
                    });
                }

                if(acceptBtn){
                    acceptBtn.addEventListener('click', function(){
                        if(checkbox) checkbox.checked = true;
                        closeModal();
                    });
                }

                closeBtns.forEach(function(b){ b.addEventListener('click', closeModal); });

                // close on Esc
                document.addEventListener('keydown', function(e){ if(e.key === 'Escape') closeModal(); });

                // click outside to close
                if(modal){ modal.addEventListener('click', function(e){ if(e.target === modal) closeModal(); }); }
            })();
        </script>
        <script type="module" src="supabaseClient.js"></script>
        <script type="module" src="registration.js"></script>

    <script>
(function(){
    var msgEl = document.getElementById('formMessage');
    var form = document.getElementById('registrationForm');
    var submit = form ? form.querySelector('button[type="submit"]') : document.getElementById('submitBtn');
    var textInput = document.getElementById('username');
    var email = document.getElementById('email');
    var password = document.getElementById('password');
    var confirmPassword = document.getElementById('confirmPassword');
    var roleSelect = document.getElementById('role');
    var identityDocument = document.getElementById('identityDocument');
    var plateNumber = document.getElementById('plateNumber');
    var licenseNumber = document.getElementById('licenseNumber');
    var commuterDocType = document.getElementById('commuterDocType');

    // Validation patterns
    var patterns = {
        password: /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[a-zA-Z\d@$!%*?&]{8,}$/,
        identityDocument: /^[A-Za-z0-9-]+$/,
        plateNumber: /^[A-Z]{3}[- ]?\d{3,4}$/,
        licenseNumber: /^[A-Z]\d{2}-\d{2}-\d{6}$/,
        email: /^[a-zA-Z0-9._%+-]+@gmail\.com$/ 
    };

    function showInline(text, isError){
        if(!msgEl){ alert(text); return; }
        msgEl.textContent = text;
        msgEl.style.display = 'block';
        if(isError){
            msgEl.style.background = 'rgba(255,80,80,0.06)';
            msgEl.style.color = '#8a1f1f';
            msgEl.style.border = '1px solid rgba(255,80,80,0.14)';
        } else {
            msgEl.style.background = 'rgba(74,157,74,0.12)';
            msgEl.style.color = '#1f7a1f';
            msgEl.style.border = '1px solid rgba(74,157,74,0.18)';
        }
        clearTimeout(msgEl.__hide);
        msgEl.__hide = setTimeout(function(){ msgEl.style.display = 'none'; }, 6000);
    }

    // override global alert to show inline messages when possible
    (function(){
        var nativeAlert = window.alert.bind(window);
        window.alert = function(txt){
            if(msgEl) showInline(String(txt), true);
            else nativeAlert(txt);
        };
    })();

    // validate before letting module/script handle registration
    if(form){
        form.addEventListener('submit', function(e){
            if(textInput && !textInput.value.trim()){
                e.preventDefault();
                e.stopImmediatePropagation();
                showInline('Please enter your username.', true);
                return;
            }
          
            if(!confirmPassword || !confirmPassword.value){
                e.preventDefault();
                e.stopImmediatePropagation();
                showInline('Please confirm your password.', true);
                return;
            }

            if(!password || !password.value){
                e.preventDefault();
                e.stopImmediatePropagation();
                showInline('Please enter a password.', true);
                return;
            }

            if(!patterns.password.test(password.value)){
                e.preventDefault();
                e.stopImmediatePropagation();
                showInline('Password must be at least 8 characters and include uppercase, lowercase, numbers, and special characters (@$!%*?&).', true);
                return;
            }

            if(password.value !== confirmPassword.value){
                e.preventDefault();
                e.stopImmediatePropagation();
                showInline('Passwords do not match.', true);
                return;
            }

            if(!roleSelect || !roleSelect.value){
                e.preventDefault();
                e.stopImmediatePropagation();
                showInline('Please select a role.', true);
                return;
            }

            if(!patterns.email.test(email.value)){
                e.preventDefault();
                e.stopImmediatePropagation();
                showInline('Please enter a valid Gmail address.', true);
                return;
            }

            if(roleSelect.value === 'commuter'){
                if(!commuterDocType || !commuterDocType.value){
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    showInline('Please select an ID document type.', true);
                    return;
                }

                if(!identityDocument || !identityDocument.value.trim()){
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    showInline('Please enter your identity document number.', true);
                    return;
                }

                if(!patterns.identityDocument.test(identityDocument.value)){
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    showInline('Invalid ID format. Use letters, numbers, and hyphens only.', true);
                    return;
                }

            } else if(roleSelect.value === 'driver'){
                if(!plateNumber || !plateNumber.value.trim()){
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    showInline('Please enter your vehicle plate number.', true);
                    return;
                }

                if(!licenseNumber || !licenseNumber.value.trim()){
                    e.preventDefault();
                    e.stopImmediatePropagation();
                    showInline('Please enter your license number.', true);
                    return;
                }
            }
            showInline('Creating account... ', false);
        });
    }
})();
</script>
    </script>
       <script src="login-slideshow.js"></script>
</body>
</html>